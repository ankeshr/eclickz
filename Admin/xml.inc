<?php

		 /*
			  	________________________________________________________________________________

						  PROGRAM : ASP : SQL Schema Admin Center (PHP)
        VERSION : 2.11
        Purpose :
      ________________________________________________________________________________
         Copyright and Legal Notices:

           All source code, images, programs, files included in this distribution
           Copyright (c) eClickZ Interactive Services LLC.  All Rights Reserved.

           Use, distibution, sale, or access to this program is forbidden without
           permission, except were permitted by the license agreement.
      ________________________________________________________________________________
         Special Instructions and notes...
      ________________________________________________________________________________
   */


		class xmlAdmin
		{

				var $output;

				function xmlAdmin ()
				{
						// Includes & Setup
				}


				################################################################################
				# Run the requested action
				################################################################################
				function go ()
				{
						global $CGI;
						$action = $CGI[ 'action' ];
						if ( !$action ) {
								$action = "mainmenu";
						}
						if ( method_exists ( $this , $action ) ) {
								call_user_func ( array ( &$this , $action ) );
						} elseif ( function_exists ( $action ) ) {
								call_user_func ( $action );
						} else {
								admin_output ( "ERROR" , "Invalid Action: $action" );
								exit;
						}
				}

				function mainmenu ()
				{
						admin_output ( "Program Configuration" , "Testing SQL Admin" );
				}

				function help ()
				{
						global $SCRIPT_NAME;
						$OUTPUT = "

                <h2>XML Admin</h2>

                <b>Turning Feeds On or Off</b><br />
                You can easily turn on or off any of the XML Feeds you have configured
                by using the drop lists on the 'List Feeds' Screen.  Before you turn a feed on,
                you should <a href='$PROG_URL?action=signup'>Sign Up</a> with the search
                engine that provides the feed.  signing up is very important, as it ensures
                that you will be <b>paid</b> for any clicks that are generated by your
                website.
                <blockquote>
                <I>Note that iWeb, Inc. has negotiated with these search engines to
                get you, in all cases, a higher than average revenue share.  They need know
                that you're a hyperseek user and are prepared to get your integration
                started right away.</I><br /><br />
                <center><B><a href='$SCRIPT_NAME?admin=xml&action=signup'>Signup URLs</a></b></center>
                </blockquote>
                <hr>

                <B>Editing Feeds</B><br />
                Simply click on the feed name in the 'List Feeds' screen, and you can turn it
                on or off, change it's url or XML Formatting.   Generally, iWeb will provide
                new format updates to you automatically, but you can easily add new feeds using
                the same form.

                <HR>

                <B>Using the feeds in your search engine</B><br />
                You simply need to change the option under 'Hyperseek Options -> Search Options' labled
                'Do you wish to use Backup Results for your own database?'.
                <br /><br />
                Set this to 'Live XML', and your feeds will instantly be pulled on each search,
                will appear as part of &lt;!-- PLUGIN:BODY --&gt; ( PLUGIN('main_output') for PHP users ).


            ";
						admin_output ( "XML Feed Quick Help" , $OUTPUT );
				}

				function signup ()
				{
						print "
                <h2>Signup for XML Feeds</h2>

                <table bgcolor='black' align='center' cellspacing=1 cellpadding=5 width=50%>
                   <tr bgcolor='silver'>
                     <th>Search Engine</th>
                     <th>Rev Share %</th>
                     <th>Signup Link</th>
                   </tr>

                   <tr bgcolor='white'>
                       <td>Look Quick</td>
                       <td>60%</td>
                       <td><a href='https://secure.lookquick.com/manager.look?action=partnersignup&partner=iweb'>signup</a></td>
                   </tr>

                   <tr bgcolor='white'>
                       <td>Kanoodle</td>
                       <td>40%</td>
                       <td><a href='URL'>Signup</a></td>
                   </tr>

                   <tr bgcolor='white'>
                       <td>Revenue Pilot</td>
                       <td>60%</td>
                       <td><a href='http://www.revenuepilot.com/iwebsys/'>Signup</a></td>
                   </tr>

                   <tr bgcolor='white'>
                       <td>Search Feed</td>
                       <td>40%</td>
                       <td><a href='https://www.searchfeed.com/rd/rdPages/HyperSeek.jsp'>Signup</a></td>
                   </tr>

                   <tr bgcolor='white'>
                       <td>Search 123</td>
                       <td>50%</td>
                       <td><a href='http://mgmt.search123.com/newpartner?TPC=NzQ0Mw2&PRC=60458'>Signup</a></td>
                   </tr>

                </table>

            ";
						admin_output ( "XML Feed Signup Links" , $OUTPUT );
				}

				function list_feeds ( $message = '' )
				{
						global $CGI;
						global $oSQL;
						global $SCRIPT_NAME;
						global $LICENSE_TYPE;
						$SQL   = "SELECT engine_name, active_status FROM " . XML_FEEDS_TABLE . " ORDER BY engine_name";
						$feeds = $oSQL->search ( array ( "SQL" => $SQL ) );
						$list  = '';
						foreach ( $feeds as $feed ) {
								$enc_engine = urlencode ( $feed[ engine_name ] );
								if ( !preg_match ( "/unlimited|source/i" , $LICENSE_TYPE ) && $feed[ 'engine_name' ] == "DEFAULT" ) {
										$list .= "
                        <tr bgcolor='white'>
                           <td>Default Feed</td>
                           <td><b>Enabled</b>
                               <input type='hidden' name='DEFAULT:active_status' value='YES' />
                           </td>
                        </tr>
                    ";
								} else {
										$list .= "
                        <tr bgcolor='white'>
                           <td><a href='$SCRIPT_NAME?admin=xml&action=edit_feed&engine=$enc_engine'>$feed[engine_name]</a></td>
                           <td><select name='$feed[engine_name]:active_status'>
                               <option value='$feed[active_status]' selected>$feed[active_status]</option>
                               <option value='YES'>YES</option>
                               <option value='NO'>NO</option>
                           </td>
                        </tr>
                    ";
								}
						}
						$OUTPUT = "
                $message
                <form action='$SCRIPT_NAME' method='post'>
                <table bgcolor='black' align='center' cellspacing=1 cellpadding=5 width=50%>
                   <tr bgcolor='silver'>
                     <th>ENGINE</th>
                     <th>ACTIVE</th>
                   </tr>
                   $list
                   <tr bgcolor='white'>
                      <td colspan='2' align='right'>
                         <input type='submit' value='Change Statuses'>
                         <input type='hidden' name='action' value='change_status'>
                         <input type='hidden' name='admin' value='xml'>
                      </td>
                   </tr>
                   <tr bgcolor='white'>
                      <td colspan='2' align='center'>
                         <a href='$SCRIPT_NAME?admin=xml&action=add'>Add New Feed</a>
                      </td>
                   </tr>
                </table>
                </form>
            ";
						admin_output ( "List Feeds" , $OUTPUT );
				}

				function add () { return $this->edit_feed (); }

				function edit_menu ()
				{
						global $CGI;
						$ret = "<a href='$SCRIPT_NAME?action=edit_feed&admin=xml&engine={$CGI['engine']}'>Feed Base</a> | ";
						$ret .= "<a href='$SCRIPT_NAME?action=edit_feed_whitelisting&admin=xml&engine={$CGI['engine']}'>Feed Whitelisting</a>";

						return $ret;
				}

				function edit_feed ()
				{
                                               
                                    
						global $ccodes;
						global $CGI;
						global $language;
						global $SCRIPT_NAME;
						global $oSQL;
						global $LICENSE_TYPE;
						if ( $CGI[ 'engine' ] == "DEFAULT" ) {
								//admin_output("ERROR", "You are not permitted to edit the default feed settings");
								//exit;
						}
						$feed       = new Record( array ( 'Parent' => $oSQL , 'Table' => XML_FEEDS_TABLE , 'Schema' => XML_FEEDS_TABLE , 'Lookup' => 1 , 'engine_name' => $CGI[ engine ] ) );
						$ccodes     = $feed->data[ restrict_to_country ];
						$formarray  = $feed->generate_form ();
						$formfields = '';
						while ( list ( $prompt , $fieldinput ) = each ( $formarray ) ) {
								$formfields .= "<tr bgcolor='#e0e0e0'><td>$prompt</td><td>$fieldinput</td></tr>\n";
						}
						$OUTPUT = $this->edit_menu () . "
                <form action='$SCRIPT_NAME' method='post'>
                <table bgcolor='black' align='center' cellspacing='1' cellpadding='5' width='80%'>
                   <tr bgcolor='silver'>
                     <td colspan='2'>
                         <b>$CGI[engine]</b>
                     </td>
                   </tr>

                   $formfields

                   <tr bgcolor='white'>
                      <td colspan='2' align='center'>
                         <input type='submit' value='$language[save_feed]'>
                         <input type='hidden' name='action' value='save_feed'>
                         <input type='hidden' name='admin' value='xml'>
                      </td>
                   </tr>

                   <tr bgcolor='white'>
                      <td colspan='2'>
                         Notes....<br /><br />
                         In the URL, use the following variables to indicate the things we need to send
                         to the xml feed:

                         <br /><br />
                         [TERMS] -- Search Terms<br />
                         [START] -- Starting Number<br />
                         [END]   -- Ending Number<br />
                         [SHOW]  -- Number to show<br />
                         [ID]    -- Your affiliate ID<br />
                         [IP]    -- Your visitor's IP address<br />
                         [UA]    -- Your visitor's Browser User Agent<br />
                         [REF]   -- Referring URL that asked for the feed<br />
                         [PUBID] -- Referring XML feed provider<br />

                         <br /><br />
                         <b>XML Feed Type</b><br />
                         Type 1, Type 2 or Type 3 depends on if the feed resembles one of the following:<br />

                         <B>1:</B><PRE>
               &lt;record&gt;
                 &lt;title&gt;....&lt;/title&gt;
                 &lt;url&gt;www.comain.com&lt;/url&gt;
                 &lt;description&gt;.....&lt;/description&gt;
                 &lt;bidprice&gt;0.13&lt;/bidprice&gt;
                 &lt;clickurl&gt;http:// .... &lt;/clickurl&gt;
               &lt;/record&gt;
                         </PRE>

                         <b>2:</b><pre>
               &lt;listing link='http://....'
                           title='....'
                           domain='www.domain.com'
                           description='xx.'
                           bid='0.07' /
               &gt;
                         </pre>

                         <b>2:</b><pre>
               &lt;listing link='http://....'
                           title='....'
                           domain='www.domain.com'
                           bid='0.07'
               &gt;

               &lt;description&gt;.....&lt;/description&gt;

               &lt;/listing&gt;
                         </pre>

                      </td>
                   </tr>

                </table>
                </form>
            ";
						admin_output ( "Generate All" , $OUTPUT );
				}

				function edit_feed_whitelisting ()
				{
						global $ccodes;
						global $CGI;
						global $language;
						global $SCRIPT_NAME;
						global $oSQL;
						global $LICENSE_TYPE;
						global $config;
						if ( $CGI[ 'engine' ] == "DEFAULT" ) {
								//admin_output("ERROR", "You are not permitted to edit the default feed settings");
								//exit;
						}
						if ( $CGI[ 'del' ] == "y" ) //Delete entry
						{
								$SQL = "delete from iweb_affiliate_blacklist where id={$CGI['id']}";
								$oSQL->run ( $SQL );
						}
						// Tables
						$accounts = ACCOUNTS_TABLE;
						$affinfo  = AFF_INFO_TABLE;
						$SQL      = "
                SELECT $accounts.*, $affinfo.*
                FROM $accounts, $affinfo
                WHERE $affinfo.affiliate = $accounts.acct_id
                ORDER BY $accounts.acct_id ASC
            ";
						$results  = $oSQL->search ( array ( "SQL" => $SQL ) );
						$OUTPUT   = $this->edit_menu ();
						$OUTPUT .= "
                <form action='$SCRIPT_NAME?action=edit_feed_whitelisting&admin=xml&engine={$CGI['engine']}' method='post' id='edit-wl'>
                <table bgcolor='black' align='center' cellspacing='1' cellpadding='5' width='80%'>
                   <tr bgcolor='silver'>
                     <td colspan='2'>
                         <b>Whitelist Management for Feed: $CGI[engine]</b>
                     </td>
                   </tr>
                   <tr bgcolor='silver'>
                     <td colspan=2>Publishers</td>
                   </tr>
                   <tr bgcolor='white'>
                      <td>Navigate:</td>
                      <td><select name='publisher' id='publisher' onchange=\"window.location.href='$SCRIPT_NAME?action=edit_feed_whitelisting&admin=xml&engine={$CGI['engine']}&publisher='+document.getElementById('publisher').value\">
                        <option value=''></option>";
						foreach ( $results as $account ) {
								$OUTPUT .= "<option value='{$account['affiliate']}'";
								if ( $CGI[ 'publisher' ] == $account[ 'affiliate' ] ) $OUTPUT .= " SELECTED ";
								$OUTPUT .= ">{$account['affiliate']}</option>";
						}
						$OUTPUT .= "
					</select></td></tr>";
						if ( $CGI[ 'publisher' ] != "" ) {
								$SQL     = "
	                SELECT subid
                	FROM iweb_jh_affiliate_summary
            	    WHERE acct_id='{$CGI[publisher]}'
        	        GROUP BY subid
    	        ";
								$results = $oSQL->search ( array ( "SQL" => $SQL ) );
								$OUTPUT .= "
                   <tr bgcolor='white'>
                      <td>Unlisted publishers:</td>
                      <td><select name='subid'>
                      		<option value='ALL'>Entire Account</option>";
								foreach ( $results as $account ) {
										$OUTPUT .= "<option value='{$account['subid']}'>{$account['subid']}</option>";
								}
								$OUTPUT .= "
					</select></td></tr>";
						}
						$OUTPUT .= "
                   <tr bgcolor='white'>
                      <td colspan='2' align='center'>
                         <input type='submit' name='type' value='Blacklist'>
                         <input type='submit' name='type' value='Whitelist'>
                         <input type='hidden' name='action' value='save_wl_feed'>
                         <input type='hidden' name='admin' value='xml'>
                         <input type='hidden' name='engine' value='$CGI[engine]'>
                      </td>
                   </tr>
                   <tr bgcolor='silver'><td colspan=2>Current Whitelists/Blacklists</td></tr>
                   <tr bgcolor='white'><td colspan=2>";
						$SQL     = "
	                SELECT *
                	FROM iweb_affiliate_blacklist
            	    WHERE engine='{$CGI[engine]}'";
						$results = $oSQL->search ( array ( "SQL" => $SQL ) );
						$OUTPUT .= "
	            	<table>
                   <tr>
                      <th style='border:solid 1px'>Publisher</th>
                      <th style='border:solid 1px'>Subid</th>
                      <th style='border:solid 1px'>Type</th>
                      <th style='border:solid 1px'>Action</th>
                    </tr>";
						foreach ( $results as $account ) {
								if ( $account[ 'type' ] == "bl" ) $type = "Blacklist"; else
										$type = "Whitelist";
								$OUTPUT .= "<tr bgcolor='white' style='border:solid 1px'>";
								$OUTPUT .= "<td>{$account['acct_id']}</td><td>{$account['subid']}</td>";
								$OUTPUT .= "<td>{$type}</td>";
								$OUTPUT .= "<td><a href='$SCRIPT_NAME?action=edit_feed_whitelisting&admin=xml&engine={$CGI['engine']}&del=y&id={$account['id']}'>Remove</a></td>";
								$OUTPUT .= "</tr>";
						}
						$OUTPUT .= "</table>";
						$OUTPUT .= "</td></tr></table></form>";
						admin_output ( "Generate All" , $OUTPUT );
				}

				function save_feed ()
				{
            global $iSQL;
						global $CGI;
						$message = '';
						$engine  = $CGI[ 'engine_name' ];
						if ( $CGI[ 'engine_name' ] == "DEFAULT" ) {
								//admin_output("ERROR", "You are not permitted to edit the default feed settings");
								//exit;
						}
    				$feed = new Record( array ( 'Parent' => $iSQL , 'Table' => XML_FEEDS_TABLE , 'Schema' => XML_FEEDS_TABLE , 'Lookup' => 1 , 'engine_name' => $engine ) );

  if ( $feed->update_values ( $CGI ) ) {
        if ( $feed->save () ) {
              $linksSQL = "SELECT * FROM iweb_xml_feeds WHERE engine_name = '".$engine."'";
              
              $links = $iSQL->search ( array ( "SQL"=>$linksSQL, "Return"=>'set' ) );

              //echo $links[0][feed_url];

              $pub_id_exist_feed_url = strstr($links[0][feed_url],'PubID=');

             // echo "in";

             // echo $pub_id_exist_feed_url;die();

             if($pub_id_exist_feed_url == ''){
                    $affiliatelinks=$links[0][affiliate_id];
                    $affiliateSQL = "SELECT * FROM iweb_accounts WHERE acct_id = '".$affiliatelinks."'";
                    $afflinks = $iSQL->search ( array ( "SQL"=>$affiliateSQL, "Return"=>'set' ) );
                    $unique_id = $afflinks[0][acct_unique_id]; 
                    $any_parameter_exits = strstr($links[0][feed_url],'?');

                    if($any_parameter_exits == ''){

                          $feed_url = $links[0][feed_url]."?PubID=".$unique_id;
                          $update_feed_url_query = "UPDATE iweb_xml_feeds SET feed_url='".$feed_url."' WHERE engine_name='".$engine."'";
                            //echo $update_feed_url_query;
                            //die();
                            $val = $iSQL->run($update_feed_url_query);
                             $message = "Feed Information Saved";
                           // echo $val ;die();

                    }else{
                         $feed_url = $links[0][feed_url]."&PubID=".$unique_id;
                                $update_feed_url_query = "UPDATE iweb_xml_feeds SET feed_url='".$feed_url."' WHERE engine_name='".$engine."'";
                             //  echo $update_feed_url_query;
                                  //die();
                                  $val = $iSQL->run($update_feed_url_query);
                                   $message = "Feed Information Saved";
                                  //echo $val ;die();
                          }
               }else{

                 $message = "Feed Information Saved";
               }
        }else{

          $message = "Feed Information Saved";

        }
      }else{
        $message = "Feed Information Saved";
      }
                    
  $this->list_feeds ( $message );
				
      }

				function save_wl_feed ()
				{
						global $iSQL;
						global $CGI;
						$message = '';
						$engine  = $CGI[ 'engine' ];
						if ( $CGI[ 'type' ] == "Whitelist" ) $type = "wl"; elseif ( $CGI[ 'type' ] == "Blacklist" ) $type = "bl";
						else
								$type = "gl";
						$SQL = "insert into iweb_affiliate_blacklist set engine='$engine', acct_id='{$CGI['publisher']}', subid='{$CGI['subid']}', type='{$type}'";
						$iSQL->run ( $SQL );
						$message = "Feed Information Saved";
						$this->list_feeds ( $message );
				}

				function change_status ()
				{
						global $iSQL;
						global $CGI;
						$message = '';
						foreach ( $CGI as $var => $status ) {
								if ( preg_match ( "/:/" , $var ) ) {
										list ( $engine , $junk ) = split ( ':' , $var );
										$SQL = "UPDATE " . XML_FEEDS_TABLE . " SET active_status = '$status' WHERE engine_name = '$engine'";
										$iSQL->run ( $SQL );
								}
						}
						$this->list_feeds ( "Statuses Updated" );
				}
		} // END CLASS

		// NON CLASS FUNCTIONS //

		// --------------------------------------------------------------------- //
		//  Drop list of all acceptable countries
		// --------------------------------------------------------------------- //
		function country_list ()
		{
				global $ccodes;
				$countries         = array ();
				$countries[ 'A1' ] = "Anonymous Proxy";
				$countries[ 'A2' ] = "Satellite Provider";
				$countries[ 'AD' ] = "Andorra";
				$countries[ 'AE' ] = "United Arab Emirates";
				$countries[ 'AF' ] = "Afghanistan";
				$countries[ 'AG' ] = "Antigua and Barbuda";
				$countries[ 'AI' ] = "Anguilla";
				$countries[ 'AL' ] = "Albania";
				$countries[ 'AM' ] = "Armenia";
				$countries[ 'AN' ] = "Netherlands Antilles";
				$countries[ 'AO' ] = "Angola";
				$countries[ 'AP' ] = "Asia/Pacific Region";
				$countries[ 'AQ' ] = "Antarctica";
				$countries[ 'AR' ] = "Argentina";
				$countries[ 'AS' ] = "American Samoa";
				$countries[ 'AT' ] = "Austria";
				$countries[ 'AU' ] = "Australia";
				$countries[ 'AW' ] = "Aruba";
				$countries[ 'AZ' ] = "Azerbaijan";
				$countries[ 'BA' ] = "Bosnia and Herzegovina";
				$countries[ 'BB' ] = "Barbados";
				$countries[ 'BD' ] = "Bangladesh";
				$countries[ 'BE' ] = "Belgium";
				$countries[ 'BF' ] = "Burkina Faso";
				$countries[ 'BG' ] = "Bulgaria";
				$countries[ 'BH' ] = "Bahrain";
				$countries[ 'BI' ] = "Burundi";
				$countries[ 'BJ' ] = "Benin";
				$countries[ 'BM' ] = "Bermuda";
				$countries[ 'BN' ] = "Brunei Darussalam";
				$countries[ 'BO' ] = "Bolivia";
				$countries[ 'BR' ] = "Brazil";
				$countries[ 'BS' ] = "Bahamas";
				$countries[ 'BT' ] = "Bhutan";
				$countries[ 'BV' ] = "Bouvet Island";
				$countries[ 'BW' ] = "Botswana";
				$countries[ 'BY' ] = "Belarus";
				$countries[ 'BZ' ] = "Belize";
				$countries[ 'CA' ] = "Canada";
				$countries[ 'CD' ] = "Congo";
				$countries[ 'CF' ] = "Central African Republic";
				$countries[ 'CG' ] = "Congo";
				$countries[ 'CH' ] = "Switzerland";
				$countries[ 'CI' ] = "Cote DIvoire";
				$countries[ 'CK' ] = "Cook Islands";
				$countries[ 'CL' ] = "Chile";
				$countries[ 'CM' ] = "Cameroon";
				$countries[ 'CN' ] = "China";
				$countries[ 'CO' ] = "Colombia";
				$countries[ 'CR' ] = "Costa Rica";
				$countries[ 'CU' ] = "Cuba";
				$countries[ 'CV' ] = "Cape Verde";
				$countries[ 'CY' ] = "Cyprus";
				$countries[ 'CZ' ] = "Czech Republic";
				$countries[ 'DE' ] = "Germany";
				$countries[ 'DJ' ] = "Djibouti";
				$countries[ 'DK' ] = "Denmark";
				$countries[ 'DM' ] = "Dominica";
				$countries[ 'DO' ] = "Dominican Republic";
				$countries[ 'DZ' ] = "Algeria";
				$countries[ 'EC' ] = "Ecuador";
				$countries[ 'EE' ] = "Estonia";
				$countries[ 'EG' ] = "Egypt";
				$countries[ 'EH' ] = "Western Sahara";
				$countries[ 'ER' ] = "Eritrea";
				$countries[ 'ES' ] = "Spain";
				$countries[ 'ET' ] = "Ethiopia";
				$countries[ 'EU' ] = "Europe";
				$countries[ 'FI' ] = "Finland";
				$countries[ 'FJ' ] = "Fiji";
				$countries[ 'FK' ] = "Falkland Islands";
				$countries[ 'FM' ] = "Micronesia";
				$countries[ 'FO' ] = "Faroe Islands";
				$countries[ 'FR' ] = "France";
				$countries[ 'GA' ] = "Gabon";
				$countries[ 'GB' ] = "United Kingdom";
				$countries[ 'GD' ] = "Grenada";
				$countries[ 'GE' ] = "Georgia";
				$countries[ 'GH' ] = "Ghana";
				$countries[ 'GI' ] = "Gibraltar";
				$countries[ 'GL' ] = "Greenland";
				$countries[ 'GM' ] = "Gambia";
				$countries[ 'GN' ] = "Guinea";
				$countries[ 'GP' ] = "Guadeloupe";
				$countries[ 'GQ' ] = "Equatorial Guinea";
				$countries[ 'GR' ] = "Greece";
				$countries[ 'GT' ] = "Guatemala";
				$countries[ 'GU' ] = "Guam";
				$countries[ 'GW' ] = "Guinea-Bissau";
				$countries[ 'GY' ] = "Guyana";
				$countries[ 'HK' ] = "Hong Kong";
				$countries[ 'HM' ] = "Heard Island and McDonald Islands";
				$countries[ 'HN' ] = "Honduras";
				$countries[ 'HR' ] = "Croatia";
				$countries[ 'HT' ] = "Haiti";
				$countries[ 'HU' ] = "Hungary";
				$countries[ 'ID' ] = "Indonesia";
				$countries[ 'IE' ] = "Ireland";
				$countries[ 'IL' ] = "Israel";
				$countries[ 'IN' ] = "India";
				$countries[ 'IO' ] = "British Indian Ocean Territory";
				$countries[ 'IQ' ] = "Iraq";
				$countries[ 'IR' ] = "Iran, Islamic Republic of";
				$countries[ 'IS' ] = "Iceland";
				$countries[ 'IT' ] = "Italy";
				$countries[ 'JM' ] = "Jamaica";
				$countries[ 'JO' ] = "Jordan";
				$countries[ 'JP' ] = "Japan";
				$countries[ 'KE' ] = "Kenya";
				$countries[ 'KG' ] = "Kyrgyzstan";
				$countries[ 'KH' ] = "Cambodia";
				$countries[ 'KI' ] = "Kiribati";
				$countries[ 'KM' ] = "Comoros";
				$countries[ 'KN' ] = "Saint Kitts and Nevis";
				$countries[ 'KP' ] = "Korea (South)";
				$countries[ 'KR' ] = "Korea (North)";
				$countries[ 'KW' ] = "Kuwait";
				$countries[ 'KY' ] = "Cayman Islands";
				$countries[ 'KZ' ] = "Kazakhstan";
				$countries[ 'LA' ] = "Lao Peoples Democratic Republic";
				$countries[ 'LB' ] = "Lebanon";
				$countries[ 'LC' ] = "Saint Lucia";
				$countries[ 'LI' ] = "Liechtenstein";
				$countries[ 'LK' ] = "Sri Lanka";
				$countries[ 'LR' ] = "Liberia";
				$countries[ 'LS' ] = "Lesotho";
				$countries[ 'LT' ] = "Lithuania";
				$countries[ 'LU' ] = "Luxembourg";
				$countries[ 'LV' ] = "Latvia";
				$countries[ 'LY' ] = "Libyan Arab Jamahiriya";
				$countries[ 'MA' ] = "Morocco";
				$countries[ 'MC' ] = "Monaco";
				$countries[ 'MD' ] = "Moldova";
				$countries[ 'MG' ] = "Madagascar";
				$countries[ 'MH' ] = "Marshall Islands";
				$countries[ 'MK' ] = "Macedonia";
				$countries[ 'ML' ] = "Mali";
				$countries[ 'MM' ] = "Myanmar";
				$countries[ 'MN' ] = "Mongolia";
				$countries[ 'MO' ] = "Macao";
				$countries[ 'MP' ] = "Northern Mariana Islands";
				$countries[ 'MQ' ] = "Martinique";
				$countries[ 'MR' ] = "Mauritania";
				$countries[ 'MS' ] = "Montserrat";
				$countries[ 'MT' ] = "Malta";
				$countries[ 'MU' ] = "Mauritius";
				$countries[ 'MV' ] = "Maldives";
				$countries[ 'MW' ] = "Malawi";
				$countries[ 'MX' ] = "Mexico";
				$countries[ 'MY' ] = "Malaysia";
				$countries[ 'MZ' ] = "Mozambique";
				$countries[ 'NA' ] = "Namibia";
				$countries[ 'NC' ] = "New Caledonia";
				$countries[ 'NE' ] = "Niger";
				$countries[ 'NG' ] = "Nigeria";
				$countries[ 'NI' ] = "Nicaragua";
				$countries[ 'NL' ] = "Netherlands";
				$countries[ 'NO' ] = "Norway";
				$countries[ 'NP' ] = "Nepal";
				$countries[ 'NR' ] = "Nauru";
				$countries[ 'NZ' ] = "New Zealand";
				$countries[ 'OM' ] = "Oman";
				$countries[ 'PA' ] = "Panama";
				$countries[ 'PE' ] = "Peru";
				$countries[ 'PF' ] = "French Polynesia";
				$countries[ 'PG' ] = "Papua New Guinea";
				$countries[ 'PH' ] = "Philippines";
				$countries[ 'PK' ] = "Pakistan";
				$countries[ 'PL' ] = "Poland";
				$countries[ 'PR' ] = "Puerto Rico";
				$countries[ 'PS' ] = "Palestinian Territory";
				$countries[ 'PT' ] = "Portugal";
				$countries[ 'PW' ] = "Palau";
				$countries[ 'PY' ] = "Paraguay";
				$countries[ 'QA' ] = "Qatar";
				$countries[ 'RE' ] = "Reunion";
				$countries[ 'RO' ] = "Romania";
				$countries[ 'RU' ] = "Russian Federation";
				$countries[ 'RW' ] = "Rwanda";
				$countries[ 'SA' ] = "Saudi Arabia";
				$countries[ 'SB' ] = "Solomon Islands";
				$countries[ 'SC' ] = "Seychelles";
				$countries[ 'SD' ] = "Sudan";
				$countries[ 'SE' ] = "Sweden";
				$countries[ 'SG' ] = "Singapore";
				$countries[ 'SI' ] = "Slovenia";
				$countries[ 'SK' ] = "Slovakia";
				$countries[ 'SL' ] = "Sierra Leone";
				$countries[ 'SM' ] = "San Marino";
				$countries[ 'SN' ] = "Senegal";
				$countries[ 'SO' ] = "Somalia";
				$countries[ 'SR' ] = "Suriname";
				$countries[ 'ST' ] = "Sao Tome and Principe";
				$countries[ 'SV' ] = "El Salvador";
				$countries[ 'SY' ] = "Syrian Arab Republic";
				$countries[ 'SZ' ] = "Swaziland";
				$countries[ 'TC' ] = "Turks and Caicos Islands";
				$countries[ 'TD' ] = "Chad";
				$countries[ 'TF' ] = "French Southern Territories";
				$countries[ 'TG' ] = "Togo";
				$countries[ 'TH' ] = "Thailand";
				$countries[ 'TJ' ] = "Tajikistan";
				$countries[ 'TK' ] = "Tokelau";
				$countries[ 'TM' ] = "Turkmenistan";
				$countries[ 'TN' ] = "Tunisia";
				$countries[ 'TO' ] = "Tonga";
				$countries[ 'TR' ] = "Turkey";
				$countries[ 'TT' ] = "Trinidad and Tobago";
				$countries[ 'TV' ] = "Tuvalu";
				$countries[ 'TW' ] = "Taiwan, Province of China";
				$countries[ 'TZ' ] = "Tanzania, United Republic of";
				$countries[ 'UA' ] = "Ukraine";
				$countries[ 'UG' ] = "Uganda";
				$countries[ 'UM' ] = "United States Minor Outlying Islands";
				$countries[ 'US' ] = "United States";
				$countries[ 'UY' ] = "Uruguay";
				$countries[ 'UZ' ] = "Uzbekistan";
				$countries[ 'VA' ] = "Holy See (Vatican City State)";
				$countries[ 'VC' ] = "Saint Vincent and the Grenadines";
				$countries[ 'VE' ] = "Venezuela";
				$countries[ 'VG' ] = "Virgin Islands, British";
				$countries[ 'VI' ] = "Virgin Islands, U.S.";
				$countries[ 'VN' ] = "Vietnam";
				$countries[ 'VU' ] = "Vanuatu";
				$countries[ 'WF' ] = "Wallis and Futuna";
				$countries[ 'WS' ] = "Samoa";
				$countries[ 'YE' ] = "Yemen";
				$countries[ 'YU' ] = "Yugoslavia";
				$countries[ 'ZA' ] = "South Africa";
				$countries[ 'ZM' ] = "Zambia";
				$countries[ 'ZW' ] = "Zimbabwe";
				$list              = '';
				$selected          = '';
				foreach ( $countries as $countrycode => $country ) {
						if ( preg_match ( "/$countrycode/i" , $ccodes ) ) {
								$selected .= "
                     <option value='$countrycode' selected>$country</option>
                 ";
						} else {
								$list .= "
                     <option value='$countrycode'>$country</option>
                 ";
						}
				}
				$default = " <option value=''>No Restiction</option> ";

				return $default . $selected . $list;
		}


?>
